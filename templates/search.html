{% extends 'base.html' %}

{% block title %}Search Users{% endblock %}

{% block content %}
<div class="form-section card mb-4">
  <h3><i class="fas fa-search"></i> Search Users</h3>
  
  <form method="get" action="{{ url_for('search') }}" class="admin-form">
    <div class="form-group">
      <label for="query">Name</label>
      <input
        id="query"
        type="text"
        name="query"
        placeholder="Search by name"
        value="{{ query }}"
      />
    </div>
    
    <div class="form-group">
      <label for="graduation_year">Graduation Year</label>
      <select id="graduation_year" name="graduation_year">
        <option value="">All Years</option>
        {% for year in years %}
        <option value="{{ year }}" {% if graduation_year == year %}selected{% endif %}>
          {{ year }}
        </option>
        {% endfor %}
      </select>
    </div>
    
    <div class="form-group">
      <label for="location">Location</label>
      <input
        id="location"
        type="text"
        name="location"
        placeholder="Location (e.g. Lagos, Nigeria)"
        value="{{ location }}"
      />
    </div>
    
    <button type="submit" class="btn btn-primary btn-large">
      <i class="fas fa-search"></i> Search
    </button>
  </form>
</div>

<!-- Search Results with Pagination -->
<div class="result-list">
  {% if users.items %}
    <!-- Results Summary -->
    <div class="search-summary mb-3">
      <p class="text-muted">
        <i class="fas fa-users"></i> 
        Found {{ users.total }} user{{ 's' if users.total != 1 else '' }}
        {% if query or graduation_year or location %}
          matching your search
        {% endif %}
      </p>
    </div>

    <!-- User Results -->
    {% for user in users.items %}
    <div class="card mb-3">
      <div class="card-body">
        <div class="user-info">
          <img
            src="{{ url_for('static', filename='profile_pics/' ~ user.profile_pic) }}"
            alt="{{ user.fullname }}"
            class="table-profile-pic"
          >
          <div class="user-details">
            <a href="{{ url_for('user_profile', user_id=user.id) }}" class="result-link">
              <strong>{{ user.fullname }}</strong>
            </a>
            <small>{{ user.graduation_year or 'N/A' }}, {{ user.location or 'Not set' }}</small>
            {% if user.bio %}
              <p class="user-bio mt-1">{{ user.bio[:100] }}{% if user.bio|length > 100 %}...{% endif %}</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}

    <!-- Pagination Controls -->
    {% if users.pages > 1 %}
    <div class="pagination-wrapper">
      <nav class="pagination-nav">
        {% if users.has_prev %}
          <a href="{{ url_for('search', page=users.prev_num, query=query, graduation_year=graduation_year, location=location) }}" 
             class="pagination-btn prev-btn">
            <i class="fas fa-chevron-left"></i> Previous
          </a>
        {% endif %}

        <div class="pagination-numbers">
          {% for page_num in users.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
            {% if page_num %}
              {% if page_num != users.page %}
                <a href="{{ url_for('search', page=page_num, query=query, graduation_year=graduation_year, location=location) }}" 
                   class="pagination-number">
                  {{ page_num }}
                </a>
              {% else %}
                <span class="pagination-number active">{{ page_num }}</span>
              {% endif %}
            {% else %}
              <span class="pagination-dots">...</span>
            {% endif %}
          {% endfor %}
        </div>

        {% if users.has_next %}
          <a href="{{ url_for('search', page=users.next_num, query=query, graduation_year=graduation_year, location=location) }}" 
             class="pagination-btn next-btn">
            Next <i class="fas fa-chevron-right"></i>
          </a>
        {% endif %}
      </nav>
      
      <!-- Pagination Info -->
      <div class="pagination-info">
        <small class="text-muted">
          Showing {{ users.per_page * (users.page - 1) + 1 }} to 
          {{ users.per_page * users.page if users.page < users.pages else users.total }} 
          of {{ users.total }} results
        </small>
      </div>
    </div>
    {% endif %}

  {% else %}
    <div class="no-results text-center">
      <div class="no-results-icon mb-3">
        <i class="fas fa-search" style="font-size: 3rem; color: #ccc;"></i>
      </div>
      <h4 class="text-muted">No users found</h4>
      <p class="text-muted">
        {% if query or graduation_year or location %}
          Try adjusting your search criteria or clearing some filters.
        {% else %}
          No users are registered yet.
        {% endif %}
      </p>
    </div>
  {% endif %}
</div>
{% endblock %}