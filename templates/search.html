{% extends 'base.html' %}

{% block title %}Search Users{% endblock %}

{% block content %}

<div class="form-section card mb-4">
  <h3><i class="fas fa-search"></i> Search Users</h3>
  
  <form method="get" action="{{ url_for('search') }}" class="admin-form">
    <div class="form-group">
      <label for="query">Name</label>
      <input
        id="query"
        type="text"
        name="query"
        placeholder="Search by name"
        value="{{ query }}"
      />
    </div>
    
    <div class="form-group">
      <label for="graduation_year">Graduation Year</label>
      <select id="graduation_year" name="graduation_year">
        <option value="">All Years</option>
        {% for year in years %}
        <option value="{{ year }}" {% if graduation_year == year %}selected{% endif %}>
          {{ year }}
        </option>
        {% endfor %}
      </select>
    </div>
    
    <div class="form-group">
      <label for="location">Location</label>
      <input
        id="location"
        type="text"
        name="location"
        placeholder="Location (e.g. Lagos, Nigeria)"
        value="{{ location }}"
      />
    </div>
    
    <button type="submit" class="btn btn-primary btn-large">
      <i class="fas fa-search"></i> Search
    </button>
  </form>
</div>

<!-- Search Results -->
<div class="result-list">
  {% if users.items %}
    <!-- Results Summary -->
    <div class="search-summary mb-3">
      <p class="text-muted">
        <i class="fas fa-users"></i> 
        Found {{ users.total }} user{{ 's' if users.total != 1 else '' }}
        {% if query or graduation_year or location %}
          matching your search
        {% endif %}
      </p>
    </div>

    <!-- User Results -->
    {% for user in users.items %}
    <div class="card mb-3">
      <div class="card-body">
        <div class="user-info">
          <img
            src="{{ url_for('static', filename='profile_pics/' ~ user.profile_pic) }}"
            alt="{{ user.fullname }}"
            class="table-profile-pic"
          >
          <div class="user-details">
            <a href="{{ url_for('user_profile', user_id=user.id) }}" class="result-link">
              <strong>{{ user.fullname }}</strong>
            </a>
            <small>{{ user.graduation_year or 'N/A' }}, {{ user.location or 'Not set' }}</small>
            {% if user.bio %}
              <p class="user-bio mt-1">{{ user.bio[:100] }}{% if user.bio|length > 100 %}...{% endif %}</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}

  {% else %}
    <div class="no-results text-center">
      <div class="no-results-icon mb-3">
        <i class="fas fa-search" style="font-size: 3rem; color: #ccc;"></i>
      </div>
      <h4 class="text-muted">No users found</h4>
      <p class="text-muted">
        {% if query or graduation_year or location %}
          Try adjusting your search criteria or clearing some filters.
        {% else %}
          No users are registered yet.
        {% endif %}
      </p>
    </div>
  {% endif %}
</div>

<!-- Alternative pagination structure that avoids existing CSS conflicts -->
{% if users.pages > 1 %}
<div style="display: block; width: 100%; margin-top: 4rem; margin-bottom: 3rem; position: relative; z-index: 1;">
  <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    
    <!-- Navigation buttons -->
    <div style="display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
      {% if users.has_prev %}
        <a href="{{ url_for('search', page=users.prev_num, query=query, graduation_year=graduation_year, location=location) }}" 
           style="display: inline-flex; align-items: center; padding: 8px 16px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; font-size: 14px;">
          <i class="fas fa-chevron-left" style="margin-right: 5px;"></i> Previous
        </a>
      {% endif %}

      <!-- Page numbers -->
      <div style="display: flex; gap: 5px; align-items: center;">
        {% for page_num in users.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
          {% if page_num %}
            {% if page_num != users.page %}
              <a href="{{ url_for('search', page=page_num, query=query, graduation_year=graduation_year, location=location) }}" 
                 style="display: inline-block; padding: 8px 12px; background: white; color: #007bff; text-decoration: none; border: 1px solid #dee2e6; border-radius: 4px; font-size: 14px;">
                {{ page_num }}
              </a>
            {% else %}
              <span style="display: inline-block; padding: 8px 12px; background: #007bff; color: white; border: 1px solid #007bff; border-radius: 4px; font-size: 14px; font-weight: bold;">
                {{ page_num }}
              </span>
            {% endif %}
          {% else %}
            <span style="padding: 8px 4px; color: #6c757d;">...</span>
          {% endif %}
        {% endfor %}
      </div>

      {% if users.has_next %}
        <a href="{{ url_for('search', page=users.next_num, query=query, graduation_year=graduation_year, location=location) }}" 
           style="display: inline-flex; align-items: center; padding: 8px 16px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; font-size: 14px;">
          Next <i class="fas fa-chevron-right" style="margin-left: 5px;"></i>
        </a>
      {% endif %}
    </div>
        
    <!-- Page info -->
    <div style="color: #6c757d; font-size: 13px;">
      Showing {{ users.per_page * (users.page - 1) + 1 }} to 
      {{ users.per_page * users.page if users.page < users.pages else users.total }} 
      of {{ users.total }} users
    </div>
  </div>
</div>
{% endif %}

{% endblock %}