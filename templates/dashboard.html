{% extends 'base.html' %}

{% block title %}
  {% if user %}
    Dashboard â€“ {{ user.fullname }}
  {% else %}
    Dashboard
  {% endif %}
{% endblock %}

{% block content %}
<!-- Security check: Redirect if no user data -->
{% if not user %}
  <div class="alert alert-danger text-center" id="session-error">
    <h4>Session Error</h4>
    <p>Your session has expired or is invalid. Please log in again.</p>
    <a href="{{ url_for('login') }}" class="btn btn-primary">Go to Login</a>
  </div>
  <script type="application/json" id="login-url">{{ url_for('login') }}</script>
{% else %}
  <!-- Dashboard Content -->
  <div class="profile-section">
    <div class="card profile-card">
      <!-- Profile Header -->
      <div class="card-body text-center">
        {% set profile_pic = user.profile_pic if user.profile_pic else 'default.jpg' %}
        {% set default_pic_url = url_for('static', filename='profile_pics/default.jpg') %}
        <img
          src="{{ url_for('static', filename='profile_pics/' + profile_pic) }}"
          alt="Profile picture of {{ user.fullname }}"
          class="profile-pic mb-3"
          data-fallback-src="{{ default_pic_url }}"
        >
        <h2>{{ user.fullname }}</h2>
      </div>

      <!-- Profile Details -->
      <div class="card-body">
        <ul class="profile-list">
          <li><strong>Email:</strong> {{ user.email }}</li>
          <li><strong>Year of Graduation:</strong> {{ user.graduation_year if user.graduation_year else 'Not specified' }}</li>
          <li><strong>Phone:</strong> {{ user.phone if user.phone else 'Not provided' }}</li>
          <li><strong>Location:</strong> {{ user.location if user.location else 'Not set' }}</li>
          <li><strong>Bio:</strong> {{ user.bio if user.bio else 'No bio set yet' }}</li>
        </ul>

        <div class="profile-actions">
          <a href="{{ url_for('edit_profile') }}" class="btn btn-primary">
            <i class="fas fa-edit"></i> Edit Profile
          </a>
          <a href="{{ url_for('change_password') }}" class="btn btn-secondary">
            <i class="fas fa-key"></i> Change Password
          </a>
        </div>
      </div>
    </div>
  </div>
{% endif %}
{% endblock %}